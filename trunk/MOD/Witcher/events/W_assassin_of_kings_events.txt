namespace = AoK
# TO DO - remake Foltest and Arjan chain
# TO DO - make Stennis, Saskia and Henselt chain
# TO DO - make it impssible for Letho to assassinate players
# TO DO - add global notification for all Norther rulers after Letho does second assassination

################################################
# Foltest vs Arjan
################################################
# Foltet Starting Narrative
narrative_event = {
	id = AoK.1
	desc = EVTDESCAoK.1
	title = EVTNAMEAoK.1
	picture = GFX_evt_large_army
	
	is_triggered_only = yes
	
	trigger = {
		has_character_flag = AoK_foltest
	}
	
	option = {
		name = EVTOPTAAoK.1
		clr_character_flag = AoK_foltest
		set_character_flag = AoK_foltest_start
	}
}
# Arjan Starting Narrative
narrative_event = {
	id = AoK.2
	desc = EVTDESCAoK.2
	title = EVTNAMEAoK.2
	picture = GFX_evt_large_army
	
	is_triggered_only = yes
	
	trigger = {
		has_character_flag = AoK_arjan
	}
	
	option = {
		name = EVTOPTAAoK.2
		clr_character_flag = AoK_arjan
		set_character_flag = AoK_arjan_start
	}
}
# Foltest offer Arjan to surrender during siege
character_event = {
	id = AoK.3
	desc = EVTDESCAoK.3
	picture = GFX_evt_siege
	
	trigger = {
		has_character_flag = AoK_foltest_start
		siege = {
			location = { province_id = 13 } # La Valette
		}
	}
	
	option = { # Offer
		name = EVTOPTAAoK.3
		random_playable_ruler = {
			limit = { has_character_flag = AoK_arjan_start }
			character_event = { id = AoK.4 tooltip = EVTTOOLTIPAoK.4 }
		}
		clr_character_flag = AoK_foltest_start
		set_character_flag = AoK_foltest_offers_surrender
		ai_chance = { factor = 1 }
	}
	option = { # Don't offer
		name = EVTOPTBAoK.3
		clr_character_flag = AoK_foltest_start
		set_character_flag = AoK_foltest_siege
		ai_chance = { factor = 1 }
	}
}
# Arjan decides if surrender
character_event = {
	id = AoK.4
	desc = EVTDESCAoK.4
	picture = GFX_evt_siege
	
	is_triggered_only = yes
	
	trigger = {
		has_character_flag = AoK_arjan_start
	}
	
	option = { # Surrender
		name = EVTOPTAAoK.4
		ROOT = { imprison = FROM }
		clr_character_flag = AoK_arjan_start
		set_character_flag = AoK_arjan_surrender
		ai_chance = { factor = 1 }
	}
	option = { # Don't surrender
		name = EVTOPTBAoK.4
		clr_character_flag = AoK_arjan_start
		set_character_flag = AoK_arjan_fight
		ai_chance = { factor = 1 }
	}
}
# Foltest wins the siege of La Valette (on_siege_won_leader)
character_event = {
	id = AoK.5
	desc = EVTDESCAoK.5
	picture = GFX_evt_siege
	
	is_triggered_only = yes
	
	trigger = {
		OR = {
			has_character_flag = AoK_foltest_siege
			AND = {
				has_character_flag = AoK_foltest_offers_surrender
				any_playable_ruler = { has_character_flag = AoK_arjan_fight }
			}
		}
		FROM = { title = b_la_valette_castle }
	}
	
	option = {
		name = EVTOPTAAoK.5
		clr_character_flag = AoK_foltest_siege
		clr_character_flag = AoK_foltest_offers_surrender
		set_character_flag = AoK_foltest_won
	}
}
# Foltest wins the war decide what to do with bastards
character_event = {
	id = AoK.6
	desc = EVTDESCAoK.6
	picture = GFX_evt_child_play
	
	trigger = {
		OR = {
			has_character_flag = AoK_foltest_won
			any_playable_ruler = { has_character_flag = AoK_arjan_surrender }
		}
	}
	
	option = { # Legitimize them
		name = EVTOPTAAoK.6
		random_playable_ruler = {
			limit = { 
				OR = {
					has_character_flag = AoK_arjan_surrender
					has_character_flag = AoK_arjan_fight
				}
			}
			mother_even_if_dead = {
				any_child = {
					limit = {
						trait = bastard
						father = { character = ROOT }
					}
					remove_trait = bastard
					add_trait = legit_bastard
					move_character = ROOT
				}
			}
		}
		ai_chance = { factor = 1 }
	}
	option = { # Take them with you
		name = EVTOPTAAoK.6
		random_playable_ruler = {
			limit = { 
				OR = {
					has_character_flag = AoK_arjan_surrender
					has_character_flag = AoK_arjan_fight
				}
			}
			mother_even_if_dead = {
				any_child = {
					limit = {
						trait = bastard
						father = { character = ROOT }
					}
					move_character = ROOT
				}
			}
		}
		ai_chance = { factor = 1 }
	}
	option = { # Do nothing
		name = EVTOPTAAoK.6
		ai_chance = { factor = 1 }
	}
}

################################################
# Henselt vs Saskia & Stennis
################################################
# Henselt Starting Narrative - Parley between both sides
narrative_event = {
	id = AoK.1000
	desc = EVTDESCAoK.1000
	title = EVTNAMEAoK.1000
	picture = GFX_evt_council
	
	is_triggered_only = yes
	
	option = { # Negotiate peacfully
		name = EVTOPTAAoK.1000
		set_global_flag = parly_henselt_wishes_peace
	}
	option = { # Breake off negotions
		name = EVTOPTBAoK.1000
		set_global_flag = parly_henselt_wishes_war
	}
}
# Saskia Starting Narrative - Parley between both sides
narrative_event = {
	id = AoK.1001
	desc = EVTDESCAoK.1001
	title = EVTNAMEAoK.1001
	picture = GFX_evt_council
	
	is_triggered_only = yes
	
	option = { # Negotiate peacfully
		name = EVTOPTAAoK.1001
		set_global_flag = parly_saskia_interrupted
	}
	option = { # Breake off negotions
		name = EVTOPTBAoK.1001
		set_global_flag = parly_saskia_interrupted
	}
	option = { # Leave it up to Stennis
		name = EVTOPTBAoK.1001
	}
}
# Sennis Starting Narrative - Parley between both sides
narrative_event = {
	id = AoK.1002
	desc = EVTDESCAoK.1002
	title = EVTNAMEAoK.1002
	picture = GFX_evt_council
	
	is_triggered_only = yes
	
	option = { # Negotiate peacfully
		name = EVTOPTAAoK.1002
		set_global_flag = parly_stennis_wishes_peace
	}
	option = { # Breake off negotions
		name = EVTOPTBAoK.1002
		set_global_flag = parly_stennis_wishes_war
	}
}
# Hidden - Decide if parley will be peaceful
character_event = {
	id = AoK.1003
	desc = "Decide if parley will be peaceful or end in war"
	picture = GFX_evt_council
	
	is_triggered_only = yes
	hide_window = yes
	
	option = { # Peace
		name = "Peace"
		trigger = {
			AND = {
				has_global_flag = parly_henselt_wishes_peace
				has_global_flag = parly_stennis_wishes_peace
			}
		}
	}
	option = { # War
		name = "War"
		trigger = {
			OR = {
				has_global_flag = parly_henselt_wishes_war
				has_global_flag = parly_stennis_wishes_war
			}
		}
		ai_chance = { factor = 100 }
	}
	option = { # War because Saskia interrupted
		name = "War because Saskia interrupted parley"
		trigger = {
			has_global_flag = parly_saskia_interrupted
		}
		ai_chance = { factor = 1000 }
	}
}

################################################
# Letho
################################################
# Choose assassination target
character_event = {
	id = AoK.2000
	desc = "Choose target"
	picture = GFX_evt_shadow
	
	hide_window = yes
	is_triggered_only = yes
	
	option = { # Temeria
		name = "Temeria"
		random_independent_ruler = {
			limit = { has_landed_title = k_temeria }
			character_event = { id = AoK.2001 days = 100 random = 100 }
		}
		ai_chance = {
			factor = 1
			modifier = { factor = 2 }
			modifier = {
				factor = 0
				any_independent_ruler = {
					has_landed_title = k_temeria
					ai = no
				}
			}
		}
	}
	option = { # Kaedwen
		name = "Kaedwen"
		random_independent_ruler = {
			limit = { has_landed_title = k_kaedwen }
			character_event = { id = AoK.2001 days = 100 random = 100 }
		}
		ai_chance = {
			factor = 1
			modifier = { factor = 2 }
			modifier = {
				factor = 0
				any_independent_ruler = {
					has_landed_title = k_kaedwen
					ai = no
				}
			}
		}
	}
	option = { # Lyria and Rivia
		name = "Lyria and Rivia"
		random_independent_ruler = {
			limit = { has_landed_title = k_lyria_rivia }
			character_event = { id = AoK.2001 days = 100 random = 100 }
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				any_independent_ruler = {
					has_landed_title = k_lyria_rivia
					ai = no
				}
			}
		}
	}
	option = { # Redania
		name = "Redania"
		random_independent_ruler = {
			limit = { has_landed_title = k_redania }
			character_event = { id = AoK.2001 days = 100 random = 100 }
		}
		ai_chance = {
			factor = 1
			modifier = { factor = 1.5 }
			modifier = {
				factor = 0
				any_independent_ruler = {
					has_landed_title = k_lyria_rivia
					ai = no
				}
			}
		}
	}
	option = { # Kovir and Poviss
		name = "Kovir and Poviss"
		random_independent_ruler = {
			limit = { has_landed_title = k_kovir_poviss }
			character_event = { id = AoK.2001 days = 100 random = 100 }
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				any_independent_ruler = {
					has_landed_title = k_kovir_poviss
					ai = no
				}
			}
		}
	}
	option = { # Hengfors League
		name = "Hengfors League"
		random_independent_ruler = {
			limit = { has_landed_title = k_hengfors_league }
			character_event = { id = AoK.2001 days = 100 random = 100 }
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				any_independent_ruler = {
					has_landed_title = k_hengfors_league
					ai = no
				}
			}
		}
	}
	option = { # Cancle assassination
		name = "Cancle assassination"
		random_playable_ruler = {
			limit = {
				has_landed_title = e_nilfgaard
				has_character_flag = AoK_emhyr
			}
			letter_event = { id = AoK.2002 }
		}
		ai_chance = { factor = 0 }
	}
}
# Kill chosen target
character_event = {
	id = AoK.2001
	desc = "Chosen target is killed by Letho"
	picture = GFX_evt_shadow
	
	hide_window = yes
	is_triggered_only = yes
	
	option = {
		name = "Died"
		death = {
			death_reason = death_murder_unknown
		}
		random_playable_ruler = {
			limit = {
				has_landed_title = e_nilfgaard
				has_character_flag = AoK_emhyr
			}
			letter_event = { id = AoK.2003 }
		}
		random_playable_ruler = {
			limit = {
				independent = yes
				culture_group = northern_group
				ai = no
			}
			narrative_event = { id = AoK.2004 }
		}
		
	}
}
# Assassination cancelled - Nilfgaard notification
letter_event = {
	id = AoK.2002
	desc = EVTDESCAoK.2002
	
	is_triggered_only = yes
	show_from_from = yes
	
	trigger = {
		has_character_flag = AoK_emhyr
	}
	
	option = {
		name = EVTOPTAAoK.2002
	}
}
# Assassination successful - Nilfgaard notification
letter_event = {
	id = AoK.2003
	desc = EVTDESCAoK.2003
	
	is_triggered_only = yes
	show_from_from = yes
	
	trigger = {
		has_character_flag = AoK_emhyr
	}
	
	option = {
		name = EVTOPTAAoK.2003
	}
}
# Assassination successful - Northern lord notification
narrative_event = {
	id = AoK.2004
	title = EVTNAMEAoK.2004
	desc = EVTDESCAoK.2004
	
	major = yes
	hide_from = yes
	
	is_triggered_only = yes
	
	trigger = {
		independent = yes
		culture_group = northern_group
		ai = no
	}
	
	option = {
		name = EVTOPTAAoK.2004
	}
}

################################################
# Emhyr
################################################
# Emhyr Starting Narrative
narrative_event = {
	id = AoK.2010
	desc = EVTDESCAoK.2010
	title = EVTNAMEAoK.2010
	picture = GFX_evt_council
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTAAoK.2010
	}
}
# Chance to start war with Nilfgaard Invasion CB
narrative_event = {
	id = AoK.2011
	desc = EVTDESCAoK.2011
	title = EVTNAMEAoK.2011
	picture = GFX_evt_council
	
	trigger = {
		has_character_flag = AoK_emhyr
	}
	
	option = {
		name = EVTOPTAAoK.2011
	}
}
